<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staking Pools</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        #particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeInDown 1s ease-out;
        }

        h1 {
            font-size: 3.5em;
            background: linear-gradient(135deg, #3b82f6, #60a5fa, #93c5fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 40px rgba(59, 130, 246, 0.3);
        }

        .subtitle {
            font-size: 1.2em;
            color: #93c5fd;
            opacity: 0.9;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            animation: fadeInUp 1s ease-out;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.4);
            border-color: #60a5fa;
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #60a5fa;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #93c5fd;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 1s ease-out;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.4);
        }

        .card h2 {
            color: #60a5fa;
            margin-bottom: 20px;
            font-size: 2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pool-item {
            background: rgba(51, 65, 85, 0.5);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
        }

        .pool-item:hover {
            background: rgba(51, 65, 85, 0.8);
            border-color: #60a5fa;
        }

        .pool-label {
            color: #93c5fd;
            font-size: 0.9em;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pool-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #fff;
            word-break: break-word;
        }

        .loading-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-top-color: #60a5fa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .mission-text {
            line-height: 1.8;
            color: #cbd5e1;
            font-size: 1.1em;
            white-space: pre-wrap;
        }

        .funding-section {
            margin-top: 20px;
        }

        .funding-item {
            background: rgba(51, 65, 85, 0.5);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #3b82f6;
        }

        .funding-percentage {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .funding-description {
            color: #cbd5e1;
            line-height: 1.6;
        }

        .pool-wrapper {
            margin-bottom: 40px;
        }

        .pool-main-header {
            background: rgba(51, 65, 85, 0.7);
            padding: 25px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.5em;
            font-weight: 700;
            color: #60a5fa;
            transition: all 0.3s ease;
            user-select: none;
            border: 2px solid rgba(59, 130, 246, 0.4);
            margin-bottom: 20px;
            position: relative;
        }

        .pool-header-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .pool-status-badge {
            font-size: 0.5em;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .badge-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }

        .badge-inactive {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .pool-status-indicator {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid rgba(30, 41, 59, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6em;
            font-weight: bold;
        }

        .pool-status-active {
            background: #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
            animation: pulse-green 2s ease-in-out infinite;
        }

        .pool-status-inactive {
            background: #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
            animation: pulse-red 2s ease-in-out infinite;
        }

        @keyframes pulse-green {
            0%, 100% {
                box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
            }
            50% {
                box-shadow: 0 0 30px rgba(16, 185, 129, 0.9);
            }
        }

        @keyframes pulse-red {
            0%, 100% {
                box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
            }
            50% {
                box-shadow: 0 0 30px rgba(239, 68, 68, 0.9);
            }
        }

        .pool-main-header:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #60a5fa;
        }

        .pool-main-arrow {
            transition: transform 0.3s ease;
            font-size: 0.8em;
        }

        .pool-main-header.active .pool-main-arrow {
            transform: rotate(180deg);
        }

        .pool-main-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .pool-main-content.active {
            max-height: 5000px;
        }

        .pool-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background: rgba(51, 65, 85, 0.3);
            border-radius: 15px;
        }

        .pool-stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .pool-stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #60a5fa;
            margin-bottom: 5px;
        }

        .pool-stat-label {
            font-size: 0.85em;
            color: #93c5fd;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-container {
            margin-top: 20px;
            padding: 20px;
            background: rgba(51, 65, 85, 0.3);
            border-radius: 15px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #93c5fd;
            font-size: 0.9em;
        }

        .countdown-timer {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .countdown-item {
            text-align: center;
            padding: 10px 15px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 10px;
            min-width: 70px;
        }

        .countdown-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #60a5fa;
        }

        .countdown-label {
            font-size: 0.75em;
            color: #93c5fd;
            text-transform: uppercase;
        }

        .accordion-section {
            margin-top: 30px;
        }

        .accordion-item {
            margin-bottom: 15px;
            border-radius: 15px;
            overflow: hidden;
            background: rgba(51, 65, 85, 0.5);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .accordion-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            font-weight: 600;
            color: #60a5fa;
            transition: all 0.3s ease;
            user-select: none;
        }

        .accordion-header:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .accordion-arrow {
            transition: transform 0.3s ease;
            font-size: 0.8em;
        }

        .accordion-header.active .accordion-arrow {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .accordion-content.active {
            max-height: 2000px;
        }

        .accordion-inner {
            padding: 20px;
            line-height: 1.8;
            color: #cbd5e1;
        }

        .accordion-inner strong {
            color: #60a5fa;
        }

        .history-log {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .history-entry {
            background: rgba(30, 41, 59, 0.6);
            padding: 15px 20px;
            border-radius: 10px;
            border-left: 3px solid #3b82f6;
        }

        .history-date {
            font-size: 0.95em;
            color: #93c5fd;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .history-filters {
            background: rgba(30, 41, 59, 0.6);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            color: #93c5fd;
            font-size: 0.9em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-select {
            padding: 10px 15px;
            border-radius: 8px;
            background: rgba(51, 65, 85, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #fff;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:hover {
            border-color: #60a5fa;
            background: rgba(51, 65, 85, 1);
        }

        .filter-select:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .history-details {
            font-size: 0.95em;
            line-height: 1.6;
        }

        .social-links {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(59, 130, 246, 0.3);
        }

        .social-links-title {
            color: #93c5fd;
            font-size: 0.9em;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .social-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
            border: 2px solid #3b82f6;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-website-small {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            color: #fff;
        }

        .btn-website-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }

        .btn-discord-small {
            background: linear-gradient(135deg, #5865f2, #7289da);
            color: #fff;
            border-color: #5865f2;
        }

        .btn-discord-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(88, 101, 242, 0.4);
        }

        footer {
            position: relative;
            z-index: 1;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            padding: 40px 20px;
            margin-top: 60px;
            border-top: 1px solid rgba(59, 130, 246, 0.2);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .footer-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 40px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1em;
            transition: all 0.3s ease;
            border: 2px solid #3b82f6;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-discord {
            background: linear-gradient(135deg, #5865f2, #7289da);
            color: #fff;
            border-color: #5865f2;
        }

        .btn-discord:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(88, 101, 242, 0.5);
        }

        .disclaimer {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .disclaimer h3 {
            color: #f87171;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .disclaimer p {
            color: #cbd5e1;
            line-height: 1.8;
            font-size: 0.95em;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            padding: 15px;
            border-radius: 10px;
            color: #fca5a5;
            margin-top: 10px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5em;
            }
            
            .pool-main-header {
                font-size: 1.2em;
                padding: 20px;
            }

            .pool-header-left {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <canvas id="particles-canvas"></canvas>
    
    <div class="container">
        <header>
            <h1>üåü Community Staking Pools</h1>
            <p class="subtitle">Stake, Earn, and Grow Together</p>
        </header>

        <!-- Quick Stats Dashboard -->
        <div class="quick-stats" id="quick-stats">
            <div class="stat-card">
                <div class="stat-icon">üéØ</div>
                <div class="stat-value" id="total-pools">0</div>
                <div class="stat-label">Total Pools</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value" id="active-pools">0</div>
                <div class="stat-label">Active Pools</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üíé</div>
                <div class="stat-value" id="total-tokens">0</div>
                <div class="stat-label">Token Types Rewarded</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìÖ</div>
                <div class="stat-value" id="days-running">0</div>
                <div class="stat-label">Days Running</div>
            </div>
        </div>

        <!-- Pools will be dynamically inserted here -->
        <div id="pools-container">
            <div class="card" id="pools-loading" style="display: flex; align-items: center; justify-content: center; gap: 15px; padding: 25px;">
                <div class="loading-indicator" style="width: 30px; height: 30px;"></div>
                <h2 style="color: #60a5fa; margin: 0; font-size: 1.5em;">Pools loading....</h2>
            </div>
        </div>

        <div class="card">
            <h2>üí∞ How I Fund The Pools</h2>
            <div class="funding-section">
                <div class="funding-item">
                    <div class="funding-percentage">90%</div>
                    <div class="funding-description">
                        From all the earned staking rewards on waxp (vote and staking rewards) will be swapped to fund rewards.
                    </div>
                </div>
                <div class="funding-item">
                    <div class="funding-percentage">30%</div>
                    <div class="funding-description">
                        The earnings from staking in discord, 30% of my AGAR earnings will be allocated to the pool.
                    </div>
                </div>
                <div class="funding-item">
                    <div class="funding-percentage">100%</div>
                    <div class="funding-description">
                        Any user or project that would like to support my initiative and donates rewards will be converted to AGAR and added to the pool.
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üéØ My Mission</h2>
            <div class="mission-text">I believe in the power of community, while I don't have any own project I have seen around projects that people come together to do what they love. I think we need to support each other and this is my way to help people, stake tokens and earn rewards. 

All the rewards will be sponsored by myself, I don't have any direct income from a collection or things I sell, while I understand people would like big rewards I can't ensure that the rewards will be consistent and it might be lower then expected.

My goal is simple: honest rewards funded by someone who believes that sharing with people can make a difference.</div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="disclaimer">
                <h3>‚ö†Ô∏è Disclaimer</h3>
                <p>
                    This staking pool is provided as-is without any warranties. Cryptocurrency staking involves risks including but not limited to smart contract vulnerabilities, market volatility, and potential loss of funds. By participating, you acknowledge that you understand these risks and that the pool operator is not responsible for any losses incurred. This is not financial advice. Always do your own research (DYOR) before staking any tokens. Past performance does not guarantee future results. Rewards are subject to change based on pool funding availability. The duration of the pool might be not extended at any point, rewards are not a guarantee and this is only out of free will and doesn't makes me responsible for any further rewards.
                    <br><br>
                    For any further questions or problems with the pools I provide feel free to contact me on discord.
                </p>
                <br>
                <a href="https://discord.com/users/1105533301504094310" class="btn btn-discord">
                    üí¨ Contact me on discord
                </a>
            </div>
        </div>
    </footer>

    <script>
        // CONFIGURATION - Update these URLs to your Google Sheets CSV exports
        const POOL_CONFIG_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTAqJxTfwNoMIpW9fM2m2dLlIKnXkriVSsrfSCxh7JY9KFjxsqL2-Oyl2pYghZWyUw5z3B0lUk0arGP/pub?output=csv';
        const POOL_HISTORY_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQnm1B5HjV7M_Ig3ZrhcxmnqKLmiGZX4nLn6ckBKZP-EmH3hm9-6eDL0V3vW9hvnSDTUQeZSU8Kkm71/pub?output=csv';
        
        // Global data storage
        const poolConfigs = {};
        const poolHistoryData = {};
        const countdownIntervals = {};

        // Helper function to format numbers
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Helper function to parse CSV
        function parseCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                const values = lines[i].split(',').map(v => v.trim());
                const entry = {};
                
                headers.forEach((header, index) => {
                    entry[header] = values[index];
                });
                
                // Skip invalid entries
                if (!entry.PoolID || entry.PoolID === 'PoolID') continue;
                
                data.push(entry);
            }
            
            return data;
        }

        // Check if pool is active
        function isPoolActive(extendedUntilDate) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const extendedDate = new Date(extendedUntilDate);
            extendedDate.setHours(0, 0, 0, 0);
            return extendedDate >= today;
        }

        // Update countdown timer
        function updateCountdown(poolId, endDate) {
            const countdownElement = document.getElementById(`countdown-${poolId}`);
            const endDateElement = document.getElementById(`end-date-${poolId}`);
            
            if (!countdownElement || !endDateElement) return;

            const end = new Date(endDate);
            end.setHours(23, 59, 59, 999);
            
            endDateElement.textContent = endDate;

            if (countdownIntervals[poolId]) {
                clearInterval(countdownIntervals[poolId]);
            }

            function update() {
                const now = new Date();
                const diff = end - now;

                if (diff <= 0) {
                    countdownElement.innerHTML = `
                        <div class="countdown-item" style="grid-column: 1/-1;">
                            <div class="countdown-value" style="color: #ef4444;">Pool Ended</div>
                        </div>
                    `;
                    clearInterval(countdownIntervals[poolId]);
                    return;
                }

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                countdownElement.innerHTML = `
                    <div class="countdown-item">
                        <div class="countdown-value">${days}</div>
                        <div class="countdown-label">Days</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value">${hours}</div>
                        <div class="countdown-label">Hours</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value">${minutes}</div>
                        <div class="countdown-label">Minutes</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-value">${seconds}</div>
                        <div class="countdown-label">Seconds</div>
                    </div>
                `;
            }

            update();
            countdownIntervals[poolId] = setInterval(update, 1000);
        }

        // Update pool status indicator
        function updatePoolStatus(poolId, entries) {
            const statusElement = document.getElementById(`status-${poolId}`);
            const badgeElement = document.getElementById(`badge-${poolId}`);
            
            if (!statusElement || entries.length === 0) return;

            const latestEntry = entries.reduce((latest, entry) => {
                const currentDate = new Date(entry.ExtendedUntil);
                const latestDate = new Date(latest.ExtendedUntil);
                return currentDate > latestDate ? entry : latest;
            });

            const extendedUntil = latestEntry.ExtendedUntil;
            const active = isPoolActive(extendedUntil);

            statusElement.className = 'pool-status-indicator';
            statusElement.classList.add(active ? 'pool-status-active' : 'pool-status-inactive');
            statusElement.innerHTML = active ? '‚úì' : '‚úï';
            statusElement.title = active ? `Active until ${extendedUntil}` : `Inactive since ${extendedUntil}`;

            if (badgeElement) {
                badgeElement.className = 'pool-status-badge';
                badgeElement.classList.add(active ? 'badge-active' : 'badge-inactive');
                badgeElement.textContent = active ? 'Active' : 'Inactive';
            }

            updateCountdown(poolId, extendedUntil);
        }

        // Calculate and display enhanced stats
        function updatePoolStats(poolId, entries) {
            if (entries.length === 0) return;

            const amounts = entries.map(e => parseFloat(e.Amount || 0));
            const total = amounts.reduce((sum, val) => sum + val, 0);
            const average = total / amounts.length;
            const largest = Math.max(...amounts);
            const distributions = entries.length;

            const dates = entries.map(e => new Date(e.Date));
            const startDate = new Date(Math.min(...dates));
            const today = new Date();
            const daysActive = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));

            const avgElement = document.getElementById(`avg-reward-${poolId}`);
            const largestElement = document.getElementById(`largest-reward-${poolId}`);
            const distributionsElement = document.getElementById(`distributions-${poolId}`);
            const daysActiveElement = document.getElementById(`days-active-${poolId}`);

            if (avgElement) avgElement.textContent = formatNumber(Math.round(average));
            if (largestElement) largestElement.textContent = formatNumber(largest);
            if (distributionsElement) distributionsElement.textContent = distributions;
            if (daysActiveElement) daysActiveElement.textContent = daysActive;
        }

        // Update global stats
        function updateGlobalStats() {
            let totalPools = 0;
            let totalActivePools = 0;
            let uniqueTokens = new Set();
            let earliestDate = new Date();

            Object.keys(poolHistoryData).forEach(poolId => {
                const entries = poolHistoryData[poolId];
                if (entries.length === 0) return;

                totalPools++;

                entries.forEach(entry => {
                    if (entry.TokenSymbol) uniqueTokens.add(entry.TokenSymbol);
                });

                const latestEntry = entries.reduce((latest, entry) => {
                    const currentDate = new Date(entry.ExtendedUntil);
                    const latestDate = new Date(latest.ExtendedUntil);
                    return currentDate > latestDate ? entry : latest;
                });

                if (isPoolActive(latestEntry.ExtendedUntil)) {
                    totalActivePools++;
                }

                entries.forEach(entry => {
                    const date = new Date(entry.Date);
                    if (date < earliestDate) earliestDate = date;
                });
            });

            const today = new Date();
            const daysRunning = Math.floor((today - earliestDate) / (1000 * 60 * 60 * 24));

            document.getElementById('total-pools').textContent = totalPools;
            document.getElementById('active-pools').textContent = totalActivePools;
            document.getElementById('total-tokens').textContent = uniqueTokens.size;
            document.getElementById('days-running').textContent = daysRunning > 0 ? daysRunning : 0;
        }

        // Populate filter options
        function populateFilters(poolId, entries) {
            const labelSelect = document.querySelector(`#filters-${poolId} select`);
            if (!labelSelect) return;

            const labels = [...new Set(entries.map(e => e.Label || 'None'))];
            
            const currentOptions = labelSelect.querySelectorAll('option');
            currentOptions.forEach((opt, index) => {
                if (index > 0) opt.remove();
            });

            labels.forEach(label => {
                const option = document.createElement('option');
                option.value = label;
                option.textContent = label;
                labelSelect.appendChild(option);
            });
        }

        // Filter and display history
        function filterHistory(poolId) {
            const filtersContainer = document.getElementById(`filters-${poolId}`);
            if (!filtersContainer) return;

            const selects = filtersContainer.querySelectorAll('select');
            const labelFilter = selects[0].value;
            const sortOrder = selects[1].value;

            let entries = [...(poolHistoryData[poolId] || [])];

            if (labelFilter !== 'all') {
                entries = entries.filter(e => (e.Label || 'None') === labelFilter);
            }

            entries.sort((a, b) => {
                const dateA = new Date(a.Date);
                const dateB = new Date(b.Date);
                return sortOrder === 'latest' ? dateB - dateA : dateA - dateB;
            });

            displayHistoryEntries(poolId, entries);
        }

        // Display history entries
        function displayHistoryEntries(poolId, entries) {
            const historyElement = document.getElementById(`history-${poolId}`);
            if (!historyElement) return;

            const config = poolConfigs[poolId];
            const tokenSymbol = config?.RewardToken || 'Tokens';

            if (entries.length === 0) {
                historyElement.innerHTML = '<p style="color: #93c5fd;">No history entries match the selected filters.</p>';
            } else {
                historyElement.innerHTML = entries.map(entry => {
                    const date = entry.Date || 'N/A';
                    const amount = formatNumber(parseFloat(entry.Amount || 0));
                    const extendedUntil = entry.ExtendedUntil || 'N/A';
                    const ownerComment = entry.OwnerComment || 'None';
                    const label = entry.Label || 'None';

                    return `
                        <div class="history-entry">
                            <div class="history-date">
                                <div class="funding-percentage"><b>${label}</b></div> 
                                üìÖ ${date}
                            </div> 
                            <div class="history-details">
                                <strong>Rewards Added:</strong> ${amount} ${tokenSymbol}<br>
                                <strong>Pool Extended Until:</strong> ${extendedUntil}<br>
                                <strong>Comment:</strong> ${ownerComment}
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Generate pool HTML
        function generatePoolHTML(config) {
            const poolId = config.PoolID;
            
            return `
                <div class="pool-wrapper" data-pool-id="${poolId}">
                    <div class="pool-main-header" onclick="togglePoolMain(this)">
                        <div class="pool-header-left">
                            <span>üíé Pool: ${config.StakeToken} ‚áí ${config.RewardToken}</span>
                            <span class="pool-status-badge badge-active" id="badge-${poolId}">Loading...</span>
                        </div>
                        <span class="pool-main-arrow">‚ñº</span>
                        <div class="pool-status-indicator" id="status-${poolId}" title="Loading status...">
                            <span class="loading-indicator" style="width: 15px; height: 15px;"></span>
                        </div>
                    </div>
                    
                    <div class="pool-main-content">
                        <div class="card">
                            <h2>üìä Pool Information</h2>
                            <div class="pool-grid">
                                <div class="pool-item">
                                    <div class="pool-label">Token to Stake</div>
                                    <div class="pool-value">${config.StakeToken}</div>
                                </div>
                                <div class="pool-item">
                                    <div class="pool-label">Token to Earn</div>
                                    <div class="pool-value">${config.RewardToken}</div>
                                </div>
                                <div class="pool-item">
                                    <div class="pool-label">Total Given Away</div>
                                    <div class="pool-value" id="total-${poolId}">
                                        <span class="loading-indicator"></span>
                                    </div>
                                </div>
                                <div class="pool-item">
                                    <div class="pool-label">Pool Start Date</div>
                                    <div class="pool-value" id="start-date-${poolId}">Loading...</div>
                                </div>
                            </div>

                            <div class="pool-stats-grid">
                                <div class="pool-stat-item">
                                    <div class="pool-stat-value" id="avg-reward-${poolId}">-</div>
                                    <div class="pool-stat-label">Avg Reward</div>
                                </div>
                                <div class="pool-stat-item">
                                    <div class="pool-stat-value" id="largest-reward-${poolId}">-</div>
                                    <div class="pool-stat-label">Largest Reward</div>
                                </div>
                                <div class="pool-stat-item">
                                    <div class="pool-stat-value" id="distributions-${poolId}">-</div>
                                    <div class="pool-stat-label">Distributions</div>
                                </div>
                                <div class="pool-stat-item">
                                    <div class="pool-stat-value" id="days-active-${poolId}">-</div>
                                    <div class="pool-stat-label">Days Active</div>
                                </div>
                            </div>

                            <div class="progress-container">
                                <div class="progress-header">
                                    <span>‚è∞ Time Until Pool Ends</span>
                                    <span id="end-date-${poolId}">Loading...</span>
                                </div>
                                <div class="countdown-timer" id="countdown-${poolId}">
                                    <div class="countdown-item">
                                        <div class="countdown-value">-</div>
                                        <div class="countdown-label">Days</div>
                                    </div>
                                    <div class="countdown-item">
                                        <div class="countdown-value">-</div>
                                        <div class="countdown-label">Hours</div>
                                    </div>
                                    <div class="countdown-item">
                                        <div class="countdown-value">-</div>
                                        <div class="countdown-label">Minutes</div>
                                    </div>
                                    <div class="countdown-item">
                                        <div class="countdown-value">-</div>
                                        <div class="countdown-label">Seconds</div>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion-section">
                                <div class="accordion-item">
                                    <div class="accordion-header" onclick="toggleAccordion(this)">
                                        <span>üìä About the Token You Stake</span>
                                        <span class="accordion-arrow">‚ñº</span>
                                    </div>
                                    <div class="accordion-content">
                                        <div class="accordion-inner">
                                            <strong>Token Name:</strong> ${config.StakeToken}<br><br>
                                            <strong>Description:</strong> ${config.StakeTokenDesc || 'No description available'}<br><br>
                                            <strong>Contract Address:</strong> ${config.StakeTokenContract || 'N/A'}<br><br>
                                            <strong>Why Stake This Token:</strong> ${config.StakeTokenWhy || 'Support the project and earn rewards'}
                                            
                                            ${config.StakeTokenWebsite || config.StakeTokenDiscord ? `
                                            <div class="social-links">
                                                <div class="social-links-title">üîó Social Links</div>
                                                <div class="social-buttons">
                                                    ${config.StakeTokenWebsite ? `
                                                    <a href="${config.StakeTokenWebsite}" class="btn-small btn-website-small">
                                                        üåê Website
                                                    </a>` : ''}
                                                    ${config.StakeTokenDiscord ? `
                                                    <a href="${config.StakeTokenDiscord}" class="btn-small btn-discord-small">
                                                        üí¨ Discord
                                                    </a>` : ''}
                                                </div>
                                            </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <div class="accordion-header" onclick="toggleAccordion(this)">
                                        <span>üéÅ About the Token You Earn</span>
                                        <span class="accordion-arrow">‚ñº</span>
                                    </div>
                                    <div class="accordion-content">
                                        <div class="accordion-inner">
                                            <strong>Token Name:</strong> ${config.RewardToken}<br><br>
                                            <strong>Description:</strong> ${config.RewardTokenDesc || 'No description available'}<br><br>
                                            <strong>Contract Address:</strong> ${config.RewardTokenContract || 'N/A'}<br><br>
                                            <strong>Utility:</strong> ${config.RewardTokenUtility || 'Can be traded or used within the ecosystem'}
                                            
                                            ${config.RewardTokenWebsite || config.RewardTokenDiscord ? `
                                            <div class="social-links">
                                                <div class="social-links-title">üîó Social Links</div>
                                                <div class="social-buttons">
                                                    ${config.RewardTokenWebsite ? `
                                                    <a href="${config.RewardTokenWebsite}" class="btn-small btn-website-small">
                                                        üåê Website
                                                    </a>` : ''}
                                                    ${config.RewardTokenDiscord ? `
                                                    <a href="${config.RewardTokenDiscord}" class="btn-small btn-discord-small">
                                                        üí¨ Discord
                                                    </a>` : ''}
                                                </div>
                                            </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <div class="accordion-header" onclick="toggleAccordion(this)">
                                        <span>üìú Pool History</span>
                                        <span class="accordion-arrow">‚ñº</span>
                                    </div>
                                    <div class="accordion-content">
                                        <div class="accordion-inner">
                                            <div class="history-filters" id="filters-${poolId}">
                                                <div class="filter-group">
                                                    <label class="filter-label">Filter by Label:</label>
                                                    <select class="filter-select" onchange="filterHistory('${poolId}')">
                                                        <option value="all">All Labels</option>
                                                    </select>
                                                </div>
                                                <div class="filter-group">
                                                    <label class="filter-label">Sort by Date:</label>
                                                    <select class="filter-select" onchange="filterHistory('${poolId}')">
                                                        <option value="latest">Latest First</option>
                                                        <option value="oldest">Oldest First</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="history-log" id="history-${poolId}">
                                                <span class="loading-indicator"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Update pool display
        function updatePoolDisplay(poolId, entries) {
            poolHistoryData[poolId] = entries;

            let total = 0;
            entries.forEach(entry => {
                const amount = parseFloat(entry.Amount || 0);
                total += amount;
            });
            
            const config = poolConfigs[poolId];
            const tokenSymbol = config?.RewardToken || 'Tokens';
            
            const totalElement = document.getElementById(`total-${poolId}`);
            if (totalElement) {
                totalElement.innerHTML = `${formatNumber(total)} ${tokenSymbol}`;
            }
            
            // Get earliest date as start date
            const dates = entries.map(e => new Date(e.Date));
            const startDate = new Date(Math.min(...dates));
            const startDateElement = document.getElementById(`start-date-${poolId}`);
            if (startDateElement) {
                startDateElement.textContent = startDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }

            updatePoolStatus(poolId, entries);
            updatePoolStats(poolId, entries);
            populateFilters(poolId, entries);
            filterHistory(poolId);
        }

        // Load pool configurations
        async function loadPoolConfigs() {
            try {
                const response = await fetch(POOL_CONFIG_CSV_URL);
                if (!response.ok) throw new Error('Failed to fetch pool configurations');
                
                const csvText = await response.text();
                const configs = parseCSV(csvText);
                
                configs.forEach(config => {
                    poolConfigs[config.PoolID] = config;
                });
                
                return configs;
            } catch (error) {
                console.error('Error loading pool configurations:', error);
                return [];
            }
        }

        // Load pool history
        async function loadPoolHistory() {
            try {
                const response = await fetch(POOL_HISTORY_CSV_URL);
                if (!response.ok) throw new Error('Failed to fetch pool history');
                
                const csvText = await response.text();
                const history = parseCSV(csvText);
                
                const groupedHistory = {};
                history.forEach(entry => {
                    const poolId = entry.PoolID;
                    if (!groupedHistory[poolId]) {
                        groupedHistory[poolId] = [];
                    }
                    groupedHistory[poolId].push(entry);
                });
                
                return groupedHistory;
            } catch (error) {
                console.error('Error loading pool history:', error);
                return {};
            }
        }

        // Initialize the application
        async function initializeApp() {
            const configs = await loadPoolConfigs();
            const history = await loadPoolHistory();
            
            if (configs.length === 0) {
                document.getElementById('pools-container').innerHTML = `
                    <div class="error-message">
                        Unable to load pool configurations. Please contact me with the button at the bottom of the website.
                    </div>
                `;
                return;
            }
            
            const poolsContainer = document.getElementById('pools-container');
            
            // Remove loading message
            const loadingElement = document.getElementById('pools-loading');
            if (loadingElement) {
                loadingElement.remove();
            }
            
            // Clear container and add pools
            poolsContainer.innerHTML = '';
            
            configs.forEach(config => {
                const poolHTML = generatePoolHTML(config);
                poolsContainer.innerHTML += poolHTML;
            });
            
            Object.keys(history).forEach(poolId => {
                if (poolConfigs[poolId]) {
                    updatePoolDisplay(poolId, history[poolId]);
                }
            });
            
            updateGlobalStats();
        }

        // Toggle functions
        function togglePoolMain(header) {
            const content = header.nextElementSibling;
            const isActive = header.classList.contains('active');
            
            if (isActive) {
                header.classList.remove('active');
                content.classList.remove('active');
            } else {
                header.classList.add('active');
                content.classList.add('active');
            }
        }

        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const isActive = header.classList.contains('active');
            
            const allHeaders = header.closest('.pool-main-content').querySelectorAll('.accordion-header');
            const allContents = header.closest('.pool-main-content').querySelectorAll('.accordion-content');
            
            allHeaders.forEach(h => h.classList.remove('active'));
            allContents.forEach(c => c.classList.remove('active'));
            
            if (!isActive) {
                header.classList.add('active');
                content.classList.add('active');
            }
        }

        // Particle Animation
        const canvas = document.getElementById('particles-canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        const particleCount = 100;

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.radius = Math.random() * 2 + 1;
                this.opacity = Math.random() * 0.5 + 0.2;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;

                if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(59, 130, 246, ${this.opacity})`;
                ctx.fill();
            }
        }

        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }

        function connectParticles() {
            for (let i = 0; i < particles.length; i++) {
                for (let j = i + 1; j < particles.length; j++) {
                    const dx = particles[i].x - particles[j].x;
                    const dy = particles[i].y - particles[j].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < 150) {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(96, 165, 250, ${0.2 * (1 - distance / 150)})`;
                        ctx.lineWidth = 0.5;
                        ctx.moveTo(particles[i].x, particles[i].y);
                        ctx.lineTo(particles[j].x, particles[j].y);
                        ctx.stroke();
                    }
                }
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });
            connectParticles();
            requestAnimationFrame(animate);
        }

        animate();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });
    </script>
</body>
</html>